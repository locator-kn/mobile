<ion-view view-title="Suchergebnisse" class="search-result" ng-controller="TripOverviewCtrl as toc">
    <ion-nav-buttons side="right">
        <img ng-if="toc.searchView" class="image-filter" ng-click="$ionicGoBack()" src="./images/icons/edit.png">
    </ion-nav-buttons>
    <ion-content class="background-color-grey my-has-tabs">
        <ion-list class="list">
            <div class="hack-for-first-element"></div>
            <ion-item ng-repeat="result in toc.results">
                <div>
                    <div class="item trip-title-in-results">{{result.title}}</div>

                    <div ng-click="toc.showTripDetail(result._id, result.userid)">
                        <!-- use ng-ig index becaus limitBy:X doesn't work-->
                        <div ng-repeat="location in result.locations" ng-if="$index < 1">
                            <div class="image-container" ng-if="location.picture"
                                 style="background-image: url({{toc.webPath}}{{location.picture + '?size=mobile'}});background-size: cover">
                            </div>
                            <div ng-if="!location.picture" class="image-container"
                                 style="background-image: url({{location.googlemap + '&size=400x400&key=AIzaSyCveLtBw4QozQIkMstvefLSTd3_opSvHS4'}});background-size: cover">
                            </div>
                        </div>
                    </div>
                    <ul>
                        <div ng-click="toc.showTripDetail(result._id, result.userid)">
                            <li class="item item-icon-right">
                                <label>
                                    <label ng-if="result.days" class="text-bold">{{result.days}}</label>
                                    <label>{{result.days === 1 ? 'Tag' : 'Tage'}}</label>
                                    <label ng-if="result.days && result.persons" class="text-bold line">|</label>
                                    <label class="text-bold">{{result.persons}} </label>
                                    <label ng-if="result.persons">{{result.persons === 1 ? 'Person' :
                                        'Personen'}}</label>
                                    <label ng-if="result.persons || result.locations" class="text-bold line">|</label>
                                    <label class="text-bold">{{toc.numberOfElelementsIn(result.locations)}}</label>
                                    <label ng-if="result.locations">
                                        {{toc.numberOfElelementsIn(result.locations) === 1 ? 'Location' :
                                        'Locations'}}
                                    </label>
                                    <i class="icon ion-chevron-right icon-accessory"></i>
                                </label>
                            </li>
                            <li class="item" ng-if="result.start_date && result.end_date">
                                <label class="text-bold">{{toc.formatDate(result.start_date)}}</label>
                                <label>bis</label>
                                <label class="text-bold">{{toc.formatDate(result.end_date)}}</label>
                            </li>
                            <li class="item mood-container" ng-if="result.moods">
                                <div ng-repeat="mood in result.moods">
                                    <div ng-repeat="availableMood in toc.moods |filter:mood">
                                        <img class="result-mood" ng-src="./images/icons/{{availableMood.icon}}">
                                        <label class="mood-title">{{availableMood.title}}</label>
                                    </div>
                                </div>
                            </li>
                            <li class="item" ng-if="result.accommodation">
                                <label>mit Ãœbernachtung</label>
                            </li>
                        </div>
                        <li class="item trip-options">
                            <img class="icon icon-small" ng-src="./images/svg/ansehen_weiss.svg"
                                 ng-click="toc.showTripDetail(result._id, result.userid)">
                            <img class="icon" ng-src="./images/svg/alle_locations.svg"
                                 ui-sref="tab.search-result-locations({locationSourceId:result._id})">
                            <img class="icon" ng-src="./images/svg/messenger_weiss.svg"
                                 ng-if="!(result.userid === userID)"
                                 ng-click="toc.startConversation(result.user, result)">

                            <label class="user">
                                <label class="dekotext">erstellt von </label>
                                <label class="name">{{result.username || 'anonym'}}</label>
                            </label>
                        </li>
                    </ul>
                </div>
            </ion-item>
            <ion-infinite-scroll
                ng-if="!toc.noMoreItemsAvailable"
                on-infinite="toc.loadMore()"
                distance="1%">
            </ion-infinite-scroll>
        </ion-list>
    </ion-content>
</ion-view>
